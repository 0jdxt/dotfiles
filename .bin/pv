#!/bin/bash


declare -A flags
flags[CA]=ğŸ‡¨ğŸ‡¦
flags[CH]=ğŸ‡¨ğŸ‡­
flags[DE]=ğŸ‡©ğŸ‡ª
flags[FR]=ğŸ‡«ğŸ‡·
flags[HK]=ğŸ‡­ğŸ‡°
flags[HU]=ğŸ‡­ğŸ‡º
flags[IS]=ğŸ‡®ğŸ‡¸
flags[NL]=ğŸ‡³ğŸ‡±
flags[SE]=ğŸ‡¸ğŸ‡ª
flags[SG]=ğŸ‡¸ğŸ‡¬
flags[UK]=ğŸ‡¬ğŸ‡§
flags[US]=ğŸ‡ºğŸ‡¸

function get_servers {
while read -r name load city; do
    flag="${flags[$(echo "$name" | cut -d'#' -f1)]}"
    printf "$flag %-8s %-2d%% $city\n" "$name" "$load"
done<<<"$(jq -r '[.LogicalServers[] | select(.Features==4)] | sort_by(.Score)[] | [.Name, .Load, .City] | join(" ")' ~/.pvpn-cli/serverinfo.json )"
}

selected=$(get_servers | dmenu -p "select a server:" -z 500 -i)
echo "$selected"

